<?xml version="1.0" encoding="UTF-8"?>
<con:templateEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/typesystem/config">
    <con:coreEntry>
        <con:description/>
    </con:coreEntry>
    <con:router errorHandler="error-N3f577052.N1840f3a6.0.1547b337596.N7bba">
        <con:pipeline type="request" name="request-N3f57777c.N4747c719.0.14c45ccc60c.N7f9f">
            <con:stage id="_StageId-N3f57709c.N5423fe23.0.1555d6a0923.N7f4d" name="StartPipelineTime">
                <con:context/>
                <con:actions>
                    <con5:assign varName="startTime" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id>_ActionId-N5601dee9.N335049ee.0.150ffe9b30e.N7efb</con2:id>
                        <con1:expr>
                            <con2:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con2:xqueryText>
                        </con1:expr>
                    </con5:assign>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f57709c.N5423fe23.0.1555d6a0923.N7f19" name="RoutingPipelineInfors">
                <con:context/>
                <con:actions>
                    <con4:assign varName="serviceStartWithRoutingPipeline">
                        <con2:id>_ActionId-N3f57709c.N5423fe23.0.1555d6a0923.N7f16</con2:id>
                        <con4:expr>
                            <con2:xqueryText>'true'</con2:xqueryText>
                        </con4:expr>
                    </con4:assign>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f577052.N7e2cc9e0.4.15355913d47.N7d08" name="AssignCustomVariable">
                <con:context/>
                <con:actions>
                    <con3:assign varName="pipelineName" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f5770a9.1c4feb15.4.150fb10be91.N7ec6</con2:id>
                        <con3:expr>
                            <con2:xqueryText>'&lt;###NOME_DELLA_PIPELINE###>'</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con4:assign varName="dvmPath">
                        <con2:id>_ActionId-N3f577052.N7e2cc9e0.4.15355913d47.N7d07</con2:id>
                        <con4:expr>
                            <con2:xqueryText>'&lt;&lt;PATH_DVM>>'</con2:xqueryText>
                        </con4:expr>
                    </con4:assign>
                    <con6:assign varName="identificaProtocolloServizio" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7db3</con1:id>
                        <con5:expr>
                            <con1:xqueryText>'false'</con1:xqueryText>
                        </con5:expr>
                    </con6:assign>
                    <con6:assign varName="servizioRest" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N3f57f4ff.N4478c38.4.1659ebdce2b.N7ca7</con1:id>
                        <con5:expr>
                            <con1:xqueryText>if($identificaProtocolloServizio='true') then
  (if($inbound/ctx:transport/ctx:request/tp:headers/*:SOAPAction) then
    'false'
   else if(contains($inbound/ctx:transport/ctx:request/tp:headers/@xsi:type,'jms:')) then
    'false'
   else
    'true'
  )
else
'false'</con1:xqueryText>
                        </con5:expr>
                    </con6:assign>
                    <con6:assign varName="pathXquerySimpleResponse" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N3f577052.N1840f3a6.0.1547b337596.N79a3</con1:id>
                        <con5:expr>
                            <con1:xqueryText>if($servizioRest='false') then (
  'MDW_CO/transformation/createSimpleResponseEnglilsh'
) else (
  'MDW_CO/transformation/createHttpErrorResponseWithTid'
)</con1:xqueryText>
                        </con5:expr>
                    </con6:assign>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f5770a9.1c4feb15.4.150fb10be91.N7ec9" name="variableDefinition" errorHandler="error-N5601dee9.N1427cde5.0.1523f309a84.N7186">
                <con:context>
                    <con2:userNsDecl prefix="int" namespace="http://www.skytv.it/mdw/internal"/>
                </con:context>
                <con:actions>
                    <con5:assign varName="tid" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f5770a9.1c4feb15.4.150fb10be91.N7e92</con2:id>
                        <con3:expr>
                            <con2:xqueryText>if (fn:not(fn:empty($body/int:operationRequest/int:logInfos/*:tid/text()))) (: tid ricevuto da BPEL :)
then ( $body/int:operationRequest/int:logInfos/*:tid/text() )
else ( 
	if ( fn:not( fn:empty($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name='enqueueTid']/@value)) ) (: tid ricevuto dal chiamante :)
	then ( $inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name='enqueueTid']/@value ) 
	else (
		if( fn:not( fn:empty ($globalTid)) ) (: tid ricevuto dalla routing :)
		then ( $globalTid )
		else ( fn-bea:uuid() )
	) 
)</con2:xqueryText>
                        </con3:expr>
                    </con5:assign>
                    <con3:assign varName="globalTid" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f57709c.325e03e5.0.155a55be376.N7f21</con2:id>
                        <con3:expr>
                            <con2:xqueryText>$tid</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con5:assign varName="operationName" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f57777c.N4747c719.0.14c45ccc60c.N7f69</con2:id>
                        <con3:expr>
                            <con2:xqueryText>fn:substring-after($body/*/name(), "request")</con2:xqueryText>
                        </con3:expr>
                    </con5:assign>
                    <con4:assign varName="listOfFieldDVM" xmlns:con5="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7eba</con6:id>
                        <con4:expr>
                            <con1:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">dvm:lookup("MDW_CDM/DVM/DVMStructure", "DVMName", $dvmPath, "DVMStructure", "ENTRY NOT FOUND")</con1:xqueryText>
                        </con4:expr>
                    </con4:assign>
                    <con4:assign varName="dvmValues" xmlns:con5="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7eb7</con6:id>
                        <con4:expr>
                            <con1:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">&lt;dvmValues>
{
dvm:lookupValue1M($dvmPath, 'operation', $operationName, fn:tokenize($listOfFieldDVM, " "))
}
&lt;/dvmValues></con1:xqueryText>
                        </con4:expr>
                    </con4:assign>
                    <con3:assign varName="logLevel" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7eb4</con2:id>
                        <con3:expr>
                            <con2:xqueryText>if( empty($dvmValues/logLevel/text())) then( 1 )
else ( $dvmValues/logLevel/text() )</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:assign varName="requestHeader" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f577052.N1840f3a6.0.1547b337596.N7aa7</con2:id>
                        <con3:expr>
                            <con2:xqueryText>$header</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con6:assign varName="validaitionEnabled" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57c7ff.N445c4bb2.0.15f2439f478.N7aca</con7:id>
                        <con5:expr>
                            <con1:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">if (fn:empty($inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name='validationEnabled']/@value))
then 'true'
else $inbound/ctx:transport/ctx:request/tp:headers/tp:user-header[@name='validationEnabled']/@value</con1:xqueryText>
                        </con5:expr>
                    </con6:assign>
                    <con6:assign varName="namespaceForValidation" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7ebd</con7:id>
                        <con5:expr>
                            <con1:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">if( empty( $dvmValues/namespace/text() )) then ( 'namespace_not_found' )
else ( $dvmValues/namespace/text() )</con1:xqueryText>
                        </con5:expr>
                    </con6:assign>
                </con:actions>
            </con:stage>
            <con:stage name="startLog" id="_StageId-N3f5770a9.1c4feb15.4.150fb10be91.N7ed1" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                <con:context xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                    <con2:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                    <con3:variable name="soapHeaderSky" path="$requestHeader" asChild="true">
                        <con3:schema ref="MDW_CDM/EnterpriseObjects/CommonEntities/SoapHeaderSKY" element="Header"/>
                    </con3:variable>
                </con:context>
                <con:actions>
                    <con5:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:id>_ActionId-N3f5770a9.1c4feb15.4.150fb10be91.N7ed0</con2:id>
                        <con3:case id="_BranchId-N3f5770a9.1c4feb15.4.150fb10be91.N7ecf">
                            <con3:condition>
                                <con2:xqueryText>xs:integer($logLevel) >= xs:integer(1)</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con5:assign varName="serviceHeaderRequest">
                                    <con2:id>_ActionId-N560177c1.69a347bb.0.15a5b369151.N7f88</con2:id>
                                    <con5:expr>
                                        <con2:xqueryText>$inbound/ctx:transport/ctx:request/tp:headers</con2:xqueryText>
                                    </con5:expr>
                                </con5:assign>
                                <con1:route>
                                    <con2:id>_ActionId-N3f5770a9.1c4feb15.4.150fb10be91.N7ece</con2:id>
                                    <con1:service ref="MDW_CO/businessServices/BS_LOG_ENQUEUE" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:outboundTransform>
                                        <con5:routing-options>
                                            <con2:id>_ActionId-N3f5770a9.1c4feb15.4.150fb10be91.N7ecd</con2:id>
                                            <con3:qualityOfService>best-effort</con3:qualityOfService>
                                        </con5:routing-options>
                                        <con3:replace contents-only="true" varName="body">
                                            <con2:id>_ActionId-N3f5770a9.1c4feb15.4.150fb10be91.N7ecc</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="MDW_CDM/ApplicationObjects/LOG/trasformation/populate_log"/>
                                                    <con2:param name="timeStamp">
                                                        <con2:path>fn:current-dateTime()</con2:path>
                                                    </con2:param>
                                                    <con2:param name="executionTime">
                                                        <con2:path>''</con2:path>
                                                    </con2:param>
                                                    <con2:param name="header_http">
                                                        <con2:path>$serviceHeaderRequest</con2:path>
                                                    </con2:param>
                                                    <con2:param name="error_code">
                                                        <con2:path>""</con2:path>
                                                    </con2:param>
                                                    <con2:param name="severity">
                                                        <con2:path>'INFO'</con2:path>
                                                    </con2:param>
                                                    <con2:param name="soapHeader">
                                                        <con2:path>$header</con2:path>
                                                    </con2:param>
                                                    <con2:param name="sourceSystem">
                                                        <con2:path>$requestHeader/data:Header/data:systemSender/text()</con2:path>
                                                    </con2:param>
                                                    <con2:param name="description">
                                                        <con2:path>concat('START pipeline (',fn:string($startTime),'). operation: ',$operationName)</con2:path>
                                                    </con2:param>
                                                    <con2:param name="targetSystem">
                                                        <con2:path>$requestHeader/data:Header/data:systemTarget/text()</con2:path>
                                                    </con2:param>
                                                    <con2:param name="pipeline">
                                                        <con2:path>$pipelineName</con2:path>
                                                    </con2:param>
                                                    <con2:param name="proxy">
                                                        <con2:path>fn:substring-after($inbound/@name, "proxy$")</con2:path>
                                                    </con2:param>
                                                    <con2:param name="clientRequestID">
                                                        <con2:path>$requestHeader/data:Header/data:transactionID/text()</con2:path>
                                                    </con2:param>
                                                    <con2:param name="tid">
                                                        <con2:path>$tid</con2:path>
                                                    </con2:param>
                                                    <con2:param name="payLoad">
                                                        <con2:path>if(xs:integer($logLevel) >= xs:integer(3)) then &lt;notlogged>&lt;/notlogged> else $body</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con3:replace>
                                    </con1:outboundTransform>
                                </con1:route>
                            </con3:actions>
                        </con3:case>
                        <con3:default/>
                    </con5:ifThenElse>
                </con:actions>
            </con:stage>
            <con:placeholder-node id="PlaceholderID_N3f5770a9.1c4feb15.4.150fb10be91.N7e89"/>
            <con:stage name="ValidationStage" errorHandler="error-a290ab9.556e6777.0.15ee8191cf4.N7e42" id="_StageId-a290ab9.556e6777.0.15ee8191cf4.N7e49" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                <con:context xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                    <con2:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data"/>
                </con:context>
                <con:actions>
                    <con3:assign varName="validationRequestFlag" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7e48</con2:id>
                        <con3:expr>
                            <con2:xqueryText>if( empty( $dvmValues/enableValidationRequest/text() )) then ( 'NOT_FOUND' )
else ( $dvmValues/enableValidationRequest/text() )</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7e47</con2:id>
                        <con3:case id="_BranchId-a290ab9.556e6777.0.15ee8191cf4.N7e46">
                            <con3:condition>
                                <con2:xqueryText>$validationRequestFlag="true" and $validaitionEnabled="true"</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:validate>
                                    <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7e45</con2:id>
                                    <con5:resourceExpr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="MDW_CO/transformation/dyn_validation"/>
                                            <con2:param name="schema">
                                                <con2:path>if( empty( $dvmValues/schema/text() )) then ( 'default' )
else ( $dvmValues/schema/text() )</con2:path>
                                            </con2:param>
                                            <con2:param name="localname_type">
                                                <con2:path>if( empty( $dvmValues/requestType/text() )) then ( 'default' )
else ( $dvmValues/requestType/text() )</con2:path>
                                            </con2:param>
                                            <con2:param name="namespace">
                                                <con2:path>$namespaceForValidation</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con5:resourceExpr>
                                    <con3:varName>body</con3:varName>
                                    <con3:location>
                                        <con2:xpathText>./*</con2:xpathText>
                                    </con3:location>
                                </con3:validate>
                            </con3:actions>
                        </con3:case>
                        <con3:case id="_BranchId-a290ab9.556e6777.0.15ee8191cf4.N7e44">
                            <con3:condition>
                                <con2:xqueryText>$validationRequestFlag="false" or $validaitionEnabled="false"</con2:xqueryText>
                            </con3:condition>
                            <con3:actions/>
                        </con3:case>
                        <con3:default>
                            <con3:Error>
                                <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7e43</con2:id>
                                <con3:errCode>1007</con3:errCode>
                                <con3:message>"Richiesta non riconosciuta"</con3:message>
                            </con3:Error>
                        </con3:default>
                    </con3:ifThenElse>
                </con:actions>
            </con:stage>
            <con:placeholder-node id="PlaceholderID_a290ab9.556e6777.0.15ee8191cf4.N7eb3" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config"/>
        </con:pipeline>
        <con:pipeline type="response" name="response-N3f57777c.N4747c719.0.14c45ccc60c.N7f9e">
            <con:stage name="st_createResponseHeader" id="_StageId-a290ab9.556e6777.0.15ee8191cf4.N7d2b" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                <con:context xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                    <con2:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                    <con3:variable name="wsHeader" path="$wsHeader" asChild="true">
                        <con3:schema ref="MDW_CDM/EnterpriseObjects/CommonEntities/SoapHeaderSKY" element="Header"/>
                    </con3:variable>
                </con:context>
                <con:actions>
                    <con6:ifThenElse xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57f4ff.N16dc8558.4.165ae1ebdb6.N7fcc</con7:id>
                        <con6:case id="_BranchId-N3f57f4ff.N16dc8558.4.165ae1ebdb6.N7fcb">
                            <con6:condition>
                                <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$servizioRest = 'false'</con7:xqueryText>
                            </con6:condition>
                            <con6:actions>
                                <con5:replace varName="header" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                    <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7d2a</con2:id>
                                    <con3:expr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="MDW_CO/transformation/create_soap_header"/>
                                            <con2:param name="StatusCode">
                                                <con2:path>0</con2:path>
                                            </con2:param>
                                            <con2:param name="messageID">
                                                <con2:path>'Service completed successfully'</con2:path>
                                            </con2:param>
                                            <con2:param name="timeStamp">
                                                <con2:path>fn:current-dateTime()</con2:path>
                                            </con2:param>
                                            <con2:param name="internalTransactionID">
                                                <con2:path>$tid</con2:path>
                                            </con2:param>
                                            <con2:param name="StatusMessage">
                                                <con2:path>''</con2:path>
                                            </con2:param>
                                            <con2:param name="systemSender">
                                                <con2:path>''</con2:path>
                                            </con2:param>
                                            <con2:param name="transactionID">
                                                <con2:path>$requestHeader/data:Header/data:transactionID/text()</con2:path>
                                            </con2:param>
                                            <con2:param name="systemTarget">
                                                <con2:path>''</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con3:expr>
                                </con5:replace>
                            </con6:actions>
                        </con6:case>
                        <con6:default>
                            <con6:transport-headers>
                                <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57f4ff.N16dc8558.4.165ae1ebdb6.N7f96</con7:id>
                                <con6:header-set>inbound-response</con6:header-set>
                                <con6:header value="expression" name="MDW_INTERNAL_TID">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$tid</con7:xqueryText>
                                </con6:header>
                                <con6:header value="expression" name="MDW_SENDER_TID">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$requestHeader/data:Header/data:transactionID/text()</con7:xqueryText>
                                </con6:header>
                                <con6:header value="expression" name="MDW_TIMESTAMP">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con7:xqueryText>
                                </con6:header>
                                <con6:header value="expression" name="MDW_RESULT_CODE">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">'0'</con7:xqueryText>
                                </con6:header>
                                <con6:header value="expression" name="MDW_RESULT_DESCRIPTION">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">'Service completed successfully'</con7:xqueryText>
                                </con6:header>
                            </con6:transport-headers>
                            <con6:ifThenElse>
                                <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-a290a47.5903895e.0.165c2c455bf.N7e67</con7:id>
                                <con6:case id="_BranchId-a290a47.5903895e.0.165c2c455bf.N7e66">
                                    <con6:condition>
                                        <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$dvmValues/restResponseNoPayload/text()='true'</con7:xqueryText>
                                    </con6:condition>
                                    <con6:actions>
                                        <con6:replace varName="body" contents-only="true">
                                            <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-a290a47.5903895e.0.165c2c455bf.N7e33</con7:id>
                                            <con6:expr>
                                                <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">''</con7:xqueryText>
                                            </con6:expr>
                                        </con6:replace>
                                    </con6:actions>
                                </con6:case>
                                <con6:default/>
                            </con6:ifThenElse>
                        </con6:default>
                    </con6:ifThenElse>
                </con:actions>
            </con:stage>
            <con:placeholder-node id="PlaceholderID_N3f5770a9.1c4feb15.4.150fb10be91.N7cc9"/>
            <con:stage name="st_validate_response" errorHandler="error-a290ab9.556e6777.0.15ee8191cf4.N7dca" id="_StageId-a290ab9.556e6777.0.15ee8191cf4.N7dd1" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                <con:context xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                    <con2:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data"/>
                </con:context>
                <con:actions>
                    <con3:assign varName="validationResponseFlag" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7dd0</con2:id>
                        <con3:expr>
                            <con2:xqueryText>if($dvmValues/restResponseNoPayload/text()='true') then(
'false'
) else (
  if( empty( $dvmValues/enableValidationResponse/text() )) then ( 'NOT_FOUND' )
  else ( $dvmValues/enableValidationResponse/text() )
)</con2:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7dcf</con2:id>
                        <con3:case id="_BranchId-a290ab9.556e6777.0.15ee8191cf4.N7dce">
                            <con3:condition>
                                <con2:xqueryText>$validationResponseFlag="true"</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:validate>
                                    <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7dcd</con2:id>
                                    <con5:resourceExpr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="MDW_CO/transformation/dyn_validation"/>
                                            <con2:param name="schema">
                                                <con2:path>if( empty( $dvmValues/schema/text() )) then ( 'default' )
else ( $dvmValues/schema/text() )</con2:path>
                                            </con2:param>
                                            <con2:param name="localname_type">
                                                <con2:path>if( empty( $dvmValues/responseType/text() )) then ( 'default' )
else ( $dvmValues/responseType/text() )</con2:path>
                                            </con2:param>
                                            <con2:param name="namespace">
                                                <con2:path>$namespaceForValidation</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con5:resourceExpr>
                                    <con3:varName>body</con3:varName>
                                    <con3:location>
                                        <con2:xpathText>./*</con2:xpathText>
                                    </con3:location>
                                </con3:validate>
                            </con3:actions>
                        </con3:case>
                        <con3:case id="_BranchId-a290ab9.556e6777.0.15ee8191cf4.N7dcc">
                            <con3:condition>
                                <con2:xqueryText>$validationResponseFlag="false"</con2:xqueryText>
                            </con3:condition>
                            <con3:actions/>
                        </con3:case>
                        <con3:default>
                            <con3:Error>
                                <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7dcb</con2:id>
                                <con3:errCode>1006</con3:errCode>
                                <con3:message>Operation Not Found in DVM</con3:message>
                            </con3:Error>
                        </con3:default>
                    </con3:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage name="endLog" id="_StageId-N3f5770a9.1c4feb15.4.150fb10be91.N7dac" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                <con:context xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                    <con2:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                    <con3:variable name="soapHeaderSky" path="$soapHeaderSky" asChild="false">
                        <con3:schema ref="MDW_CDM/EnterpriseObjects/CommonEntities/SoapHeaderSKY" element="Header"/>
                    </con3:variable>
                </con:context>
                <con:actions>
                    <con5:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f5770a9.1c4feb15.4.150fb10be91.N7dab</con2:id>
                        <con3:case id="_BranchId-N3f5770a9.1c4feb15.4.150fb10be91.N7daa">
                            <con3:condition>
                                <con2:xqueryText>xs:integer($logLevel) >= xs:integer(1)</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:assign varName="serviceHeaderResponse">
                                    <con2:id>_ActionId-N560177c1.69a347bb.0.15a5b369151.N7f85</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$serviceHeaderRequest</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con1:route>
                                    <con2:id>_ActionId-N3f5770a9.1c4feb15.4.150fb10be91.N7da9</con2:id>
                                    <con1:service ref="MDW_CO/businessServices/BS_LOG_ENQUEUE" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:outboundTransform>
                                        <con5:routing-options>
                                            <con2:id>_ActionId-N3f5770a9.1c4feb15.4.150fb10be91.N7da8</con2:id>
                                            <con5:qualityOfService>best-effort</con5:qualityOfService>
                                        </con5:routing-options>
                                        <con5:replace contents-only="true" varName="body">
                                            <con2:id>_ActionId-N3f5770a9.1c4feb15.4.150fb10be91.N7da7</con2:id>
                                            <con3:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="MDW_CDM/ApplicationObjects/LOG/trasformation/populate_log"/>
                                                    <con2:param name="timeStamp">
                                                        <con2:path>fn:current-dateTime()</con2:path>
                                                    </con2:param>
                                                    <con2:param name="executionTime">
                                                        <con2:path>osbgT:getExecutionTime($startTime)</con2:path>
                                                    </con2:param>
                                                    <con2:param name="header_http">
                                                        <con2:path>$serviceHeaderResponse</con2:path>
                                                    </con2:param>
                                                    <con2:param name="error_code">
                                                        <con2:path>$body/data:*/data:esito/text()</con2:path>
                                                    </con2:param>
                                                    <con2:param name="severity">
                                                        <con2:path>'INFO'</con2:path>
                                                    </con2:param>
                                                    <con2:param name="soapHeader">
                                                        <con2:path>$header</con2:path>
                                                    </con2:param>
                                                    <con2:param name="sourceSystem">
                                                        <con2:path>$header/data:Header/data:systemSender/text()</con2:path>
                                                    </con2:param>
                                                    <con2:param name="description">
                                                        <con2:path>"END pipeline."</con2:path>
                                                    </con2:param>
                                                    <con2:param name="targetSystem">
                                                        <con2:path>$header/data:Header/data:systemTarget/text()</con2:path>
                                                    </con2:param>
                                                    <con2:param name="pipeline">
                                                        <con2:path>$pipelineName</con2:path>
                                                    </con2:param>
                                                    <con2:param name="proxy">
                                                        <con2:path>fn:substring-after($inbound/@name, "proxy$")</con2:path>
                                                    </con2:param>
                                                    <con2:param name="clientRequestID">
                                                        <con2:path>''</con2:path>
                                                    </con2:param>
                                                    <con2:param name="tid">
                                                        <con2:path>$tid</con2:path>
                                                    </con2:param>
                                                    <con2:param name="payLoad">
                                                        <con2:path>if(xs:integer($logLevel) >= xs:integer(2)) then &lt;notlogged>&lt;/notlogged> else $body</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con3:expr>
                                        </con5:replace>
                                    </con1:outboundTransform>
                                </con1:route>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con:placeholder-node id="PlaceholderID_a156a09.N352c2640.0.16fd29de045.N79a6"/>
                        </con3:default>
                    </con5:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N5601dee9.N1427cde5.0.1523f309a84.N7186">
            <con:stage id="_StageId-N5601dee9.N1427cde5.0.1523f309a84.N70e5" name="ErrorHandlerInitVariables" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con:context>
                    <con1:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data"/>
                </con:context>
                <con:actions>
                    <con6:assign varName="faultRef" xmlns:con5="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601dee9.N1427cde5.0.1523f309a84.N70e4</con1:id>
                        <con2:expr>
                            <con1:xqueryText>$fault</con1:xqueryText>
                        </con2:expr>
                    </con6:assign>
                    <con5:assign varName="serviceHeaderRequest" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N560177c1.69a347bb.0.15a5b369151.N7f8b</con1:id>
                        <con5:expr>
                            <con1:xqueryText>$inbound/ctx:transport/ctx:request/tp:headers</con1:xqueryText>
                        </con5:expr>
                    </con5:assign>
                    <con1:route xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-N5601dee9.N1427cde5.0.1523f309a84.N7075</con6:id>
                        <con1:service ref="MDW_CO/businessServices/BS_LOG_ENQUEUE" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:outboundTransform>
                            <con5:routing-options>
                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-N5601dee9.N1427cde5.0.1523f309a84.N7074</con6:id>
                                <con5:qualityOfService>best-effort</con5:qualityOfService>
                            </con5:routing-options>
                            <con5:replace contents-only="true" varName="body">
                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-N5601dee9.N1427cde5.0.1523f309a84.N7073</con6:id>
                                <con3:expr>
                                    <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                                        <con6:resource ref="MDW_CDM/ApplicationObjects/LOG/trasformation/populate_log"/>
                                        <con6:param name="timeStamp">
                                            <con6:path>fn:current-dateTime()</con6:path>
                                        </con6:param>
                                        <con6:param name="executionTime">
                                            <con6:path>''</con6:path>
                                        </con6:param>
                                        <con6:param name="header_http">
                                            <con6:path>$serviceHeaderRequest</con6:path>
                                        </con6:param>
                                        <con6:param name="error_code">
                                            <con6:path>$faultRef/ctx:errorCode/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="severity">
                                            <con6:path>'ERROR'</con6:path>
                                        </con6:param>
                                        <con6:param name="soapHeader">
                                            <con6:path>$header</con6:path>
                                        </con6:param>
                                        <con6:param name="sourceSystem">
                                            <con6:path>$header/data:Header/data:systemSender/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="description">
                                            <con6:path>'Eccezione nella assegnazione delle variabili'</con6:path>
                                        </con6:param>
                                        <con6:param name="targetSystem">
                                            <con6:path>$header/data:Header/data:systemTarget/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="pipeline">
                                            <con6:path>$pipelineName</con6:path>
                                        </con6:param>
                                        <con6:param name="proxy">
                                            <con6:path>fn:substring-after($inbound/@name, "proxy$")</con6:path>
                                        </con6:param>
                                        <con6:param name="clientRequestID">
                                            <con6:path>$requestHeader/data:Header/data:transactionID/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="tid">
                                            <con6:path>$tid</con6:path>
                                        </con6:param>
                                        <con6:param name="payLoad">
                                            <con6:path>$faultRef</con6:path>
                                        </con6:param>
                                    </con6:xqueryTransform>
                                </con3:expr>
                            </con5:replace>
                        </con1:outboundTransform>
                    </con1:route>
                    <con6:Error xmlns:con5="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601dee9.N1427cde5.0.1523f309a84.N70e0</con1:id>
                        <con2:errCode>1010</con2:errCode>
                        <con2:message>errore nell'inizializzazione delle variabili</con2:message>
                    </con6:Error>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f577052.N1840f3a6.0.1547b337596.N7bba">
            <con:stage id="_StageId-N3f577052.N1840f3a6.0.1547b337596.N7b52" name="setPLException" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                <con:context>
                    <con2:variable name="firstCustomErrorInfosXSD" path="$firstCustomErrorInfos" asChild="false">
                        <con2:schema ref="MDW_CDM/EnterpriseObjects/CommonEntities/errorInfos" element="errorInfos"/>
                    </con2:variable>
                </con:context>
                <con:actions>
                    <con2:assign varName="pipelineTerminatedWithException" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N3f577052.N1840f3a6.0.1547b337596.N7b51</con1:id>
                        <con2:expr>
                            <con1:xqueryText>'true'</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7de9</con2:id>
                        <con1:case id="_BranchId-a290a7e.N39c216e2.0.1655d189eb1.N7de8">
                            <con1:condition>
                                <con2:xqueryText>fn:empty($firstCustomErrorInfos)</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="bsHeaderResponse">
                                    <con2:id>_ActionId-a291403.359e526c.0.16fe7aaa9d2.N7d57</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>$outbound/ctx:transport/ctx:response</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                                <con1:assign varName="firstCustomErrorInfos">
                                    <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7de7</con2:id>
                                    <con1:expr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="MDW_CO/transformation/createErrorInfos"/>
                                            <con2:param name="faultCode">
                                                <con2:path>if($bsHeaderResponse/*:http-response-code and (fn:data($bsHeaderResponse/*:http-response-code) = "404" or fn:data($bsHeaderResponse/*:http-response-code) = "400"))
then(fn:data($bsHeaderResponse/*:http-response-code))
else(fn:data($fault/ctx:errorCode))</con2:path>
                                            </con2:param>
                                            <con2:param name="faultDescription">
                                                <con2:path>fn:data($fault/ctx:reason)</con2:path>
                                            </con2:param>
                                            <con2:param name="httpResponseCode">
                                                <con2:path>fn:data($bsHeaderResponse/*:http-response-code)</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con1:expr>
                                </con1:assign>
                                <con:placeholder-node id="PlaceholderID_a290a7e.N39c216e2.0.1655d189eb1.N79e3" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config"/>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f577052.N1840f3a6.0.1547b337596.N7ae0" name="logError" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                <con:context>
                    <con1:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data"/>
                    <con2:variable name="varRequestHeader" path="$requestHeader" asChild="true">
                        <con2:schema ref="MDW_CDM/EnterpriseObjects/CommonEntities/SoapHeaderSKY" element="Header"/>
                    </con2:variable>
                </con:context>
                <con:actions>
                    <con5:assign varName="faultRef" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f577052.N1840f3a6.0.1547b337596.N7adf</con6:id>
                        <con5:expr>
                            <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$fault</con6:xqueryText>
                        </con5:expr>
                    </con5:assign>
                    <con1:route xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f577052.N1840f3a6.0.1547b337596.N7ade</con6:id>
                        <con1:service ref="MDW_CO/businessServices/BS_LOG_ENQUEUE" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:outboundTransform>
                            <con5:routing-options>
                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f577052.N1840f3a6.0.1547b337596.N7add</con6:id>
                                <con3:qualityOfService>best-effort</con3:qualityOfService>
                            </con5:routing-options>
                            <con3:replace contents-only="true" varName="body">
                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f577052.N1840f3a6.0.1547b337596.N7adc</con6:id>
                                <con3:expr>
                                    <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                                        <con6:resource ref="MDW_CDM/ApplicationObjects/LOG/trasformation/populate_log"/>
                                        <con6:param name="timeStamp">
                                            <con6:path>fn:current-dateTime()</con6:path>
                                        </con6:param>
                                        <con6:param name="executionTime">
                                            <con6:path>''</con6:path>
                                        </con6:param>
                                        <con6:param name="header_http">
                                            <con6:path>$firstCustomErrorInfos</con6:path>
                                        </con6:param>
                                        <con6:param name="error_code">
                                            <con6:path>$faultRef/ctx:errorCode/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="severity">
                                            <con6:path>'ERROR'</con6:path>
                                        </con6:param>
                                        <con6:param name="soapHeader">
                                            <con6:path>$header</con6:path>
                                        </con6:param>
                                        <con6:param name="sourceSystem">
                                            <con6:path>$requestHeader/data:Header/data:systemSender/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="description">
                                            <con6:path>concat('Catturata eccezione globale. Operation: ',$operationName)</con6:path>
                                        </con6:param>
                                        <con6:param name="targetSystem">
                                            <con6:path>$requestHeader/data:Header/data:systemTarget/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="pipeline">
                                            <con6:path>$pipelineName</con6:path>
                                        </con6:param>
                                        <con6:param name="proxy">
                                            <con6:path>fn:substring-after($inbound/@name, "proxy$")</con6:path>
                                        </con6:param>
                                        <con6:param name="clientRequestID">
                                            <con6:path>$requestHeader/data:Header/data:transactionID/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="tid">
                                            <con6:path>$tid</con6:path>
                                        </con6:param>
                                        <con6:param name="payLoad">
                                            <con6:path>$faultRef</con6:path>
                                        </con6:param>
                                    </con6:xqueryTransform>
                                </con3:expr>
                            </con3:replace>
                        </con1:outboundTransform>
                    </con1:route>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f577052.N1840f3a6.0.1547b337596.N7bb9" name="Replace Body and Header">
                <con:context>
                    <con2:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data"/>
                    <con5:variable name="firstCustomErrorInfosXSD" path="$firstCustomErrorInfos" asChild="false">
                        <con5:schema ref="MDW_CDM/EnterpriseObjects/CommonEntities/errorInfos" element="errorInfos"/>
                    </con5:variable>
                </con:context>
                <con:actions>
                    <con4:assign varName="localTid">
                        <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7ac1</con2:id>
                        <con4:expr>
                            <con2:xqueryText>$tid</con2:xqueryText>
                        </con4:expr>
                    </con4:assign>
                    <con3:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7ca4</con2:id>
                        <con3:case id="_BranchId-a290ab9.556e6777.0.15ee8191cf4.N7ca3">
                            <con3:condition>
                                <con2:xqueryText>(fn:exists($fault/ctx:errorCode) and ($fault/ctx:errorCode = "1001" or $fault/ctx:errorCode = "400") )
or 
($firstCustomErrorInfos/*:faultCode/text() = '400')
or 
($firstCustomErrorInfos/*:faultCode/text() = '1001')</con2:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con4:assign varName="rootNodeName" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                                    <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7af9</con2:id>
                                    <con4:expr>
                                        <con2:xqueryText>if($servizioRest='false') then (
  if( empty( $dvmValues/responseType/text() )) then ( 'default' )
  else ( $dvmValues/responseType/text() )
) else (
  'error400'
)</con2:xqueryText>
                                    </con4:expr>
                                </con4:assign>
                                <con3:assign varName="esito">
                                    <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7b0b</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$fault/ctx:errorCode/text()</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con4:assign varName="descrizioneEsito" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                                    <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7abb</con2:id>
                                    <con4:expr>
                                        <con2:xqueryText>if ($fault/ctx:errorCode = "1001") then
"Errore di validazione dell'input."
else
"errore per dati in input non validi"</con2:xqueryText>
                                    </con4:expr>
                                </con4:assign>
                                <con:placeholder-node id="PlaceholderID_a290a7e.N39c216e2.0.1655d189eb1.N79e2"/>
                                <con3:replace varName="body" contents-only="true">
                                    <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7ca2</con2:id>
                                    <con3:expr>
                                        <con2:dynamicXqueryTransform>
                                            <con2:resourceExpr>$pathXquerySimpleResponse</con2:resourceExpr>
                                            <con2:param name="esito">
                                                <con2:path>$esito</con2:path>
                                            </con2:param>
                                            <con2:param name="descrizioneEsito">
                                                <con2:path>$descrizioneEsito</con2:path>
                                            </con2:param>
                                            <con2:param name="tid">
                                                <con2:path>$localTid</con2:path>
                                            </con2:param>
                                            <con2:param name="rootNodeName">
                                                <con2:path>$rootNodeName</con2:path>
                                            </con2:param>
                                        </con2:dynamicXqueryTransform>
                                    </con3:expr>
                                </con3:replace>
                            </con3:actions>
                        </con3:case>
                        <con5:case id="_BranchId-a290ab9.556e6777.0.15ee8191cf4.N7ca1">
                            <con5:condition>
                                <con2:xqueryText>$timeoutError='true'</con2:xqueryText>
                            </con5:condition>
                            <con5:actions>
                                <con4:assign varName="rootNodeName" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                                    <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7afb</con2:id>
                                    <con4:expr>
                                        <con2:xqueryText>if($servizioRest='false') then (
if( empty( $dvmValues/responseType/text() )) then ( 'default' )
else ( $dvmValues/responseType/text() )
) else (
  'error504'
)</con2:xqueryText>
                                    </con4:expr>
                                </con4:assign>
                                <con3:assign varName="esito">
                                    <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7b07</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>'99'</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con4:assign varName="descrizioneEsito" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                                    <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7ab8</con2:id>
                                    <con4:expr>
                                        <con2:xqueryText>"Errore di timeout"</con2:xqueryText>
                                    </con4:expr>
                                </con4:assign>
                                <con:placeholder-node id="PlaceholderID_a290a7e.N39c216e2.0.1655d189eb1.N79e1"/>
                                <con5:replace varName="body" contents-only="true">
                                    <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7ca0</con2:id>
                                    <con3:expr>
                                        <con2:dynamicXqueryTransform>
                                            <con2:resourceExpr>$pathXquerySimpleResponse</con2:resourceExpr>
                                            <con2:param name="esito">
                                                <con2:path>$esito</con2:path>
                                            </con2:param>
                                            <con2:param name="descrizioneEsito">
                                                <con2:path>$descrizioneEsito</con2:path>
                                            </con2:param>
                                            <con2:param name="tid">
                                                <con2:path>$localTid</con2:path>
                                            </con2:param>
                                            <con2:param name="rootNodeName">
                                                <con2:path>$rootNodeName</con2:path>
                                            </con2:param>
                                        </con2:dynamicXqueryTransform>
                                    </con3:expr>
                                </con5:replace>
                            </con5:actions>
                        </con5:case>
                        <con5:case id="_BranchId-a290ab9.556e6777.0.15ee8191cf4.N7c9f">
                            <con5:condition>
                                <con2:xqueryText>(fn:exists($fault/ctx:errorCode) and ($fault/ctx:errorCode = "1901" or $fault/ctx:errorCode = "404") )
or 
($firstCustomErrorInfos/*:faultCode/text() = '404')
or 
($firstCustomErrorInfos/*:faultCode/text() = '1901')</con2:xqueryText>
                            </con5:condition>
                            <con5:actions>
                                <con4:assign varName="rootNodeName" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                                    <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7afd</con2:id>
                                    <con4:expr>
                                        <con2:xqueryText>if($servizioRest='false') then (
  if( empty( $dvmValues/responseType/text() )) then ( 'default' )
  else ( $dvmValues/responseType/text() )
) else (
  'error404'
)</con2:xqueryText>
                                    </con4:expr>
                                </con4:assign>
                                <con3:assign varName="esito">
                                    <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7b03</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>'1901'</con2:xqueryText>
                                    </con3:expr>
                                </con3:assign>
                                <con4:assign varName="descrizioneEsito" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                                    <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7ab5</con2:id>
                                    <con4:expr>
                                        <con2:xqueryText>"Data not found."</con2:xqueryText>
                                    </con4:expr>
                                </con4:assign>
                                <con:placeholder-node id="PlaceholderID_a290a7e.N39c216e2.0.1655d189eb1.N79e0"/>
                                <con5:replace varName="body" contents-only="true">
                                    <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7c9e</con2:id>
                                    <con3:expr>
                                        <con2:dynamicXqueryTransform>
                                            <con2:resourceExpr>$pathXquerySimpleResponse</con2:resourceExpr>
                                            <con2:param name="esito">
                                                <con2:path>$esito</con2:path>
                                            </con2:param>
                                            <con2:param name="descrizioneEsito">
                                                <con2:path>$descrizioneEsito</con2:path>
                                            </con2:param>
                                            <con2:param name="tid">
                                                <con2:path>$localTid</con2:path>
                                            </con2:param>
                                            <con2:param name="rootNodeName">
                                                <con2:path>$rootNodeName</con2:path>
                                            </con2:param>
                                        </con2:dynamicXqueryTransform>
                                    </con3:expr>
                                </con5:replace>
                            </con5:actions>
                        </con5:case>
                        <con3:default>
                            <con4:assign varName="rootNodeName" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                                <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7b16</con2:id>
                                <con4:expr>
                                    <con2:xqueryText>if($servizioRest='false') then (
  if( empty( $dvmValues/responseType/text() )) then ( 'default' )
  else ( $dvmValues/responseType/text() )
) else (
  'error500'
)</con2:xqueryText>
                                </con4:expr>
                            </con4:assign>
                            <con3:assign varName="esito">
                                <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7b13</con2:id>
                                <con3:expr>
                                    <con2:xqueryText>'1002'</con2:xqueryText>
                                </con3:expr>
                            </con3:assign>
                            <con4:assign varName="descrizioneEsito" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                                <con2:id>_ActionId-a290a7e.N39c216e2.0.1655d189eb1.N7abe</con2:id>
                                <con4:expr>
                                    <con2:xqueryText>"Errore durante l'esecuzione del servizio"</con2:xqueryText>
                                </con4:expr>
                            </con4:assign>
                            <con:placeholder-node id="PlaceholderID_a290a7e.N39c216e2.0.1655d189eb1.N79df"/>
                            <con5:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7c9d</con2:id>
                                <con3:expr>
                                    <con2:dynamicXqueryTransform>
                                        <con2:resourceExpr>$pathXquerySimpleResponse</con2:resourceExpr>
                                        <con2:param name="esito">
                                            <con2:path>$esito</con2:path>
                                        </con2:param>
                                        <con2:param name="descrizioneEsito">
                                            <con2:path>$descrizioneEsito</con2:path>
                                        </con2:param>
                                        <con2:param name="tid">
                                            <con2:path>$localTid</con2:path>
                                        </con2:param>
                                        <con2:param name="rootNodeName">
                                            <con2:path>$rootNodeName</con2:path>
                                        </con2:param>
                                    </con2:dynamicXqueryTransform>
                                </con3:expr>
                            </con5:replace>
                        </con3:default>
                    </con3:ifThenElse>
                    <con6:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57f4ff.N16dc8558.4.165ae1ebdb6.N7eb9</con7:id>
                        <con6:case id="_BranchId-N3f57f4ff.N16dc8558.4.165ae1ebdb6.N7eb8">
                            <con6:condition>
                                <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$servizioRest = 'false'</con7:xqueryText>
                            </con6:condition>
                            <con6:actions>
                                <con5:replace varName="header" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                    <con2:id>_ActionId-N3f577052.N1840f3a6.0.1547b337596.N7a3f</con2:id>
                                    <con3:expr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="MDW_CO/transformation/create_soap_header"/>
                                            <con2:param name="StatusCode">
                                                <con2:path>$esito</con2:path>
                                            </con2:param>
                                            <con2:param name="messageID">
                                                <con2:path>$requestHeader/data:messageID/text()</con2:path>
                                            </con2:param>
                                            <con2:param name="timeStamp">
                                                <con2:path>fn:current-dateTime()</con2:path>
                                            </con2:param>
                                            <con2:param name="internalTransactionID">
                                                <con2:path>$tid</con2:path>
                                            </con2:param>
                                            <con2:param name="StatusMessage">
                                                <con2:path>$descrizioneEsito</con2:path>
                                            </con2:param>
                                            <con2:param name="systemSender">
                                                <con2:path>$requestHeader/data:systemSender/text()</con2:path>
                                            </con2:param>
                                            <con2:param name="transactionID">
                                                <con2:path>$requestHeader/data:Header/data:transactionID/text()</con2:path>
                                            </con2:param>
                                            <con2:param name="systemTarget">
                                                <con2:path>$requestHeader/data:systemTarget/text()</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con3:expr>
                                </con5:replace>
                            </con6:actions>
                        </con6:case>
                        <con6:default>
                            <con6:transport-headers>
                                <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57f4ff.N16dc8558.4.165ae1ebdb6.N7eb6</con7:id>
                                <con6:header-set>inbound-response</con6:header-set>
                                <con6:header value="expression" name="MDW_INTERNAL_TID">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$tid</con7:xqueryText>
                                </con6:header>
                                <con6:header value="expression" name="MDW_SENDER_TID">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$requestHeader/data:Header/data:transactionID/text()</con7:xqueryText>
                                </con6:header>
                                <con6:header value="expression" name="MDW_TIMESTAMP">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">fn:current-dateTime()</con7:xqueryText>
                                </con6:header>
                                <con6:header value="expression" name="MDW_RESULT_CODE">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$esito</con7:xqueryText>
                                </con6:header>
                                <con6:header value="expression" name="MDW_RESULT_DESCRIPTION">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$descrizioneEsito</con7:xqueryText>
                                </con6:header>
                                <con6:header value="expression" name="MDW_DETAIL_CODE">
                                    <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$firstCustomErrorInfos/*:faultCode/text()</con7:xqueryText>
                                </con6:header>
                            </con6:transport-headers>
                        </con6:default>
                    </con6:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f577052.N1840f3a6.0.1547b337596.N7a08" name="Reply">
                <con:context/>
                <con:actions>
                    <con1:route xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con2:id>_ActionId-N3f577090.N4923650b.4.157755164b1.N7ebd</con2:id>
                        <con1:service ref="MDW_CO/businessServices/BS_LOG_ENQUEUE" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:outboundTransform>
                            <con5:routing-options>
                                <con2:id>_ActionId-N3f577090.N4923650b.4.157755164b1.N7ebc</con2:id>
                                <con3:qualityOfService>best-effort</con3:qualityOfService>
                            </con5:routing-options>
                            <con3:replace contents-only="true" varName="body">
                                <con2:id>_ActionId-N3f577090.N4923650b.4.157755164b1.N7ebb</con2:id>
                                <con3:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="MDW_CDM/ApplicationObjects/LOG/trasformation/populate_log"/>
                                        <con2:param name="timeStamp">
                                            <con2:path>fn:current-dateTime()</con2:path>
                                        </con2:param>
                                        <con2:param name="executionTime">
                                            <con2:path>if( $serviceStartWithRoutingPipeline = 'true')
then ('')
else (osbgT:getExecutionTime($startTime))</con2:path>
                                        </con2:param>
                                        <con2:param name="header_http">
                                            <con2:path>&lt;empty/></con2:path>
                                        </con2:param>
                                        <con2:param name="error_code">
                                            <con2:path>$faultRef/ctx:errorCode/text()</con2:path>
                                        </con2:param>
                                        <con2:param name="severity">
                                            <con2:path>'INFO'</con2:path>
                                        </con2:param>
                                        <con2:param name="soapHeader">
                                            <con2:path>$header</con2:path>
                                        </con2:param>
                                        <con2:param name="sourceSystem">
                                            <con2:path>$requestHeader/*:Header/*:systemSender/text()</con2:path>
                                        </con2:param>
                                        <con2:param name="description">
                                            <con2:path>concat('END pipeline with EXCEPTION. operation: ',$operationName)</con2:path>
                                        </con2:param>
                                        <con2:param name="targetSystem">
                                            <con2:path>$requestHeader/*:Header/*:systemTarget/text()</con2:path>
                                        </con2:param>
                                        <con2:param name="pipeline">
                                            <con2:path>$pipelineName</con2:path>
                                        </con2:param>
                                        <con2:param name="proxy">
                                            <con2:path>fn:substring-after($inbound/@name, "proxy$")</con2:path>
                                        </con2:param>
                                        <con2:param name="clientRequestID">
                                            <con2:path>$requestHeader/*:Header/*:transactionID/text()</con2:path>
                                        </con2:param>
                                        <con2:param name="tid">
                                            <con2:path>$tid</con2:path>
                                        </con2:param>
                                        <con2:param name="payLoad">
                                            <con2:path>$body</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con3:expr>
                            </con3:replace>
                        </con1:outboundTransform>
                    </con1:route>
                    <con6:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-N3f57f4ff.N2c6051ed.4.165b482c44d.N7f3f</con7:id>
                        <con6:case id="_BranchId-N3f57f4ff.N2c6051ed.4.165b482c44d.N7f3e">
                            <con6:condition>
                                <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$servizioRest = 'false'</con7:xqueryText>
                            </con6:condition>
                            <con6:actions>
                                <con2:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                    <con2:id>_ActionId-N3f577052.N1840f3a6.0.1547b337596.N7a0a</con2:id>
                                </con2:reply>
                            </con6:actions>
                        </con6:case>
                        <con6:case id="_BranchId-a290bbb.611d0746.4.167f06abedb.N7b0e">
                            <con6:condition>
                                <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">fn:false()</con7:xqueryText>
                            </con6:condition>
                            <con6:actions>
                                <con:placeholder-node id="PlaceholderID_a290bbb.611d0746.4.167f06abedb.N7aa2"/>
                            </con6:actions>
                        </con6:case>
                        <con6:default>
                            <con7:reply isError="true" xmlns:con7="http://www.bea.com/wli/sb/stages/config">
                                <con7:id>_ActionId-N3f57f4ff.N2c6051ed.4.165b482c44d.N7f36</con7:id>
                            </con7:reply>
                        </con6:default>
                    </con6:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline name="error-a290ab9.556e6777.0.15ee8191cf4.N7e42" type="error" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
            <con:stage id="_StageId-a290ab9.556e6777.0.15ee8191cf4.N7e41" name="logError">
                <con:context>
                    <con1:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data"/>
                    <con2:variable name="varRequestHeader" path="$requestHeader" asChild="true">
                        <con2:schema ref="MDW_CDM/EnterpriseObjects/CommonEntities/SoapHeaderSKY" element="Header"/>
                    </con2:variable>
                </con:context>
                <con:actions>
                    <con5:assign varName="faultRef" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7e40</con6:id>
                        <con5:expr>
                            <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$fault</con6:xqueryText>
                        </con5:expr>
                    </con5:assign>
                    <con1:route xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7e3f</con6:id>
                        <con1:service ref="MDW_CO/businessServices/BS_LOG_ENQUEUE" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:outboundTransform>
                            <con5:routing-options>
                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7e3e</con6:id>
                                <con3:qualityOfService>best-effort</con3:qualityOfService>
                            </con5:routing-options>
                            <con3:replace contents-only="true" varName="body">
                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7e3d</con6:id>
                                <con3:expr>
                                    <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                                        <con6:resource ref="MDW_CDM/ApplicationObjects/LOG/trasformation/populate_log"/>
                                        <con6:param name="timeStamp">
                                            <con6:path>fn:current-dateTime()</con6:path>
                                        </con6:param>
                                        <con6:param name="executionTime">
                                            <con6:path>''</con6:path>
                                        </con6:param>
                                        <con6:param name="header_http">
                                            <con6:path>&lt;empty/></con6:path>
                                        </con6:param>
                                        <con6:param name="error_code">
                                            <con6:path>$faultRef/ctx:errorCode/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="severity">
                                            <con6:path>'ERROR'</con6:path>
                                        </con6:param>
                                        <con6:param name="soapHeader">
                                            <con6:path>&lt;empty/></con6:path>
                                        </con6:param>
                                        <con6:param name="sourceSystem">
                                            <con6:path>$requestHeader/data:Header/data:systemSender/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="description">
                                            <con6:path>'Eccezione nella VALIDAZIONE della RICHIESTA'</con6:path>
                                        </con6:param>
                                        <con6:param name="targetSystem">
                                            <con6:path>$requestHeader/data:Header/data:systemTarget/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="pipeline">
                                            <con6:path>$pipelineName</con6:path>
                                        </con6:param>
                                        <con6:param name="proxy">
                                            <con6:path>fn:substring-after($inbound/@name, "proxy$")</con6:path>
                                        </con6:param>
                                        <con6:param name="clientRequestID">
                                            <con6:path>$requestHeader/data:Header/data:transactionID/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="tid">
                                            <con6:path>$tid</con6:path>
                                        </con6:param>
                                        <con6:param name="payLoad">
                                            <con6:path>$faultRef</con6:path>
                                        </con6:param>
                                    </con6:xqueryTransform>
                                </con3:expr>
                            </con3:replace>
                        </con1:outboundTransform>
                    </con1:route>
                </con:actions>
            </con:stage>
            <con:stage name="ex_validation" id="_StageId-a290ab9.556e6777.0.15ee8191cf4.N7e3c">
                <con:context xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                    <con2:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data"/>
                    <con5:variable name="varRequestHeader" path="$requestHeader" asChild="true">
                        <con5:schema ref="MDW_CDM/EnterpriseObjects/CommonEntities/SoapHeaderSKY" element="Header"/>
                    </con5:variable>
                </con:context>
                <con:actions>
                    <con3:Error xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7e3b</con2:id>
                        <con3:errCode>1001</con3:errCode>
                        <con3:message>errore di validazione della richiesta</con3:message>
                    </con3:Error>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline name="error-a290ab9.556e6777.0.15ee8191cf4.N7dca" type="error" xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
            <con:stage id="_StageId-a290ab9.556e6777.0.15ee8191cf4.N7dc9" name="logError">
                <con:context>
                    <con1:userNsDecl prefix="data" namespace="http://www.skytv.it/mdw/data"/>
                    <con2:variable name="varRequestHeader" path="$requestHeader" asChild="true">
                        <con2:schema ref="MDW_CDM/EnterpriseObjects/CommonEntities/SoapHeaderSKY" element="Header"/>
                    </con2:variable>
                </con:context>
                <con:actions>
                    <con5:assign varName="faultRef" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7dc8</con6:id>
                        <con5:expr>
                            <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$fault</con6:xqueryText>
                        </con5:expr>
                    </con5:assign>
                    <con1:route xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/publish/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7dc7</con6:id>
                        <con1:service ref="MDW_CO/businessServices/BS_LOG_ENQUEUE" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:outboundTransform>
                            <con5:routing-options>
                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7dc6</con6:id>
                                <con3:qualityOfService>best-effort</con3:qualityOfService>
                            </con5:routing-options>
                            <con3:replace contents-only="true" varName="body">
                                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7dc5</con6:id>
                                <con3:expr>
                                    <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                                        <con6:resource ref="MDW_CDM/ApplicationObjects/LOG/trasformation/populate_log"/>
                                        <con6:param name="timeStamp">
                                            <con6:path>fn:current-dateTime()</con6:path>
                                        </con6:param>
                                        <con6:param name="executionTime">
                                            <con6:path>''</con6:path>
                                        </con6:param>
                                        <con6:param name="header_http">
                                            <con6:path>&lt;empty/></con6:path>
                                        </con6:param>
                                        <con6:param name="error_code">
                                            <con6:path>$faultRef/ctx:errorCode/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="severity">
                                            <con6:path>'ERROR'</con6:path>
                                        </con6:param>
                                        <con6:param name="soapHeader">
                                            <con6:path>&lt;empty/></con6:path>
                                        </con6:param>
                                        <con6:param name="sourceSystem">
                                            <con6:path>$requestHeader/data:Header/data:systemSender/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="description">
                                            <con6:path>concat('errore di validazione della risposta. operation: ',$operationName)</con6:path>
                                        </con6:param>
                                        <con6:param name="targetSystem">
                                            <con6:path>$requestHeader/data:Header/data:systemTarget/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="pipeline">
                                            <con6:path>$pipelineName</con6:path>
                                        </con6:param>
                                        <con6:param name="proxy">
                                            <con6:path>fn:substring-after($inbound/@name, "proxy$")</con6:path>
                                        </con6:param>
                                        <con6:param name="clientRequestID">
                                            <con6:path>$requestHeader/data:Header/data:transactionID/text()</con6:path>
                                        </con6:param>
                                        <con6:param name="tid">
                                            <con6:path>$tid</con6:path>
                                        </con6:param>
                                        <con6:param name="payLoad">
                                            <con6:path>$faultRef</con6:path>
                                        </con6:param>
                                    </con6:xqueryTransform>
                                </con3:expr>
                            </con3:replace>
                        </con1:outboundTransform>
                    </con1:route>
                </con:actions>
            </con:stage>
            <con:stage name="Stage2" id="_StageId-a290ab9.556e6777.0.15ee8191cf4.N7dc4">
                <con:context xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config"/>
                <con:actions>
                    <con3:Error xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                        <con2:id>_ActionId-a290ab9.556e6777.0.15ee8191cf4.N7dc3</con2:id>
                        <con3:errCode>1004</con3:errCode>
                        <con3:message>errore di validazione della risposta</con3:message>
                    </con3:Error>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:pipeline-node name="PipelinePairNode1">
                <con:request>request-N3f57777c.N4747c719.0.14c45ccc60c.N7f9f</con:request>
                <con:response>response-N3f57777c.N4747c719.0.14c45ccc60c.N7f9e</con:response>
            </con:pipeline-node>
            <con:route-node id="_RouteId-a290a69.N447547b0.0.167306e4f0d.N6e28" name="RouteNode">
                <con:context/>
                <con:actions>
                    <con:placeholder-node id="PlaceholderID_a290a69.N447547b0.0.167306e4f0d.N6bfc"/>
                </con:actions>
            </con:route-node>
        </con:flow>
        <con:shared-variables>
            <con:variable>serviceStartWithRoutingPipeline</con:variable>
            <con:variable>globalTid</con:variable>
            <con:variable>firstCustomErrorInfos</con:variable>
            <con:variable>pipelineTerminatedWithException</con:variable>
        </con:shared-variables>
    </con:router>
</con:templateEntry>